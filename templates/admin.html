<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; background:#f5f5f5; margin:20px; }
        h1 { text-align:center; }
        table { width:100%; border-collapse: collapse; background:#fff; }
        th, td { border:1px solid #ddd; padding:10px; text-align:left; vertical-align:top; }
        th { background:#333; color:#fff; }
        tr:nth-child(even) { background:#f9f9f9; }
        .btn { padding:5px 10px; margin:2px; text-decoration:none; border-radius:4px; cursor:pointer; }
        .pending { background:#ff9800; color:white; border:none; }
        .completed { background:#4caf50; color:white; border:none; }
        .cancelled { background:#f44336; color:white; border:none; }
        form { display:inline; }
        ul { margin:0; padding-left:18px; }
        li { margin-bottom:5px; }
        .total { font-weight:bold; margin-top:8px; display:block; }
    </style>
</head>
<body>
    <h1>ðŸ“‹ Orders Dashboard</h1>
    <table>
        <thead>
            <tr>
                <th>Customer</th>
                <th>Email</th>
                <th>Address</th>
                <th>Products</th>
                <th>Status</th>
                <th>Date</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td>{{ order.customer.name }}</td>
                <td>{{ order.customer.email }}</td>
                <td>{{ order.customer.address }}, {{ order.customer.city }} - {{ order.customer.pincode }}</td>
                <td>
                    <ul>
                        {% set grand_total = 0 %}
                        {% for product in order.products %}
                            {% set line_total = product.quantity * product.price %}
                            {% set grand_total = grand_total + line_total %}
                            <li>
                                {{ product.name }} (x{{ product.quantity }}) â€“ 
                                â‚¹{{ product.price }} each | 
                                Total: â‚¹{{ line_total }}
                            </li>
                        {% endfor %}
                    </ul>
                    <span class="total">Grand Total: â‚¹{{ grand_total }}</span>
                </td>
                <td>{{ order.status }}</td>
                <td>
                    {% if order.timestamp %}
                        {{ order.timestamp.strftime("%Y-%m-%d %H:%M") }}
                    {% endif %}
                </td>
                
                <td>
                    <!-- Cancel -->
                    <form action="{{ url_for('update_order', order_id=order.id, status='Cancelled') }}" method="POST">
                        <button class="btn cancelled" type="submit">Cancel</button>
                    </form>

                    <!-- Complete -->
                    <form action="{{ url_for('update_order', order_id=order.id, status='Completed') }}" method="POST">
                        <button class="btn completed" type="submit">Complete</button>
                    </form>

                    <!-- Pending -->
                    <form action="{{ url_for('update_order', order_id=order.id, status='Pending') }}" method="POST">
                        <button class="btn pending" type="submit">Pending</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="7" style="text-align:center;">No orders found</td></tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>
